/*! RetroPhone v1.0.0 - 2014-08-09 
 *  Copyright: Peter Szerzo, 2014 */


function touchHandler(a){var b=a.changedTouches[0],c=document.createEvent("MouseEvent");c.initMouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[a.type],!0,!0,window,1,b.screenX,b.screenY,b.clientX,b.clientY,!1,!1,!1,!1,0,null),b.target.dispatchEvent(c),a.preventDefault()}var RPH={},W,H,minWH;RPH.dialer={number:"",dial:function(){window.location="tel:"+this.number}},RPH.mouseUp=function(a){RPH.mouse.up(a)},RPH.mouseDown=function(a){RPH.mouse.down(a),RPH.mouse.isDragging=RPH.phone.alpha<.03&&-1!==RPH.phone.activeDigit,RPH.phone.text.isHovered()&&RPH.dialer.dial()},RPH.mouseMove=function(a){RPH.phone.centroid.x,RPH.phone.centroid.y;RPH.mouse.move(a),RPH.mouse.isDragging?RPH.phone.setDrag():RPH.phone.alpha<.03&&RPH.phone.setActiveDigit(),RPH.fontString=RPH.phone.text.isHovered()?"bold ":"",RPH.fontString+=minWH/30+"px Courier"},RPH.draw=function(){RPH.pen.clear(),RPH.ctx.textAlign="center",RPH.ctx.textBaseline="middle",RPH.phone.drawRing(),RPH.phone.drawLine(),RPH.phone.drawNumber(),RPH.phone.drawDigits(),RPH.phone.alpha>0&&!RPH.mouse.isDragging&&(RPH.phone.alpha-=.02),RPH.canvas.addEventListener("mousedown",RPH.mouseDown),RPH.canvas.addEventListener("mousemove",RPH.mouseMove),RPH.canvas.addEventListener("mouseup",RPH.mouseUp)},RPH.init=function(){return document.addEventListener("touchstart",touchHandler,!0),document.addEventListener("touchmove",touchHandler,!0),document.addEventListener("touchend",touchHandler,!0),document.addEventListener("touchcancel",touchHandler,!0),RPH.canvas=document.getElementById("retrophone"),RPH.ctx=RPH.canvas.getContext("2d"),this.resizeCanvas(),setInterval(RPH.draw,10)},RPH.resizeCanvas=function(){RPH.canvas.width=window.innerWidth,RPH.canvas.height=window.innerHeight,W=RPH.canvas.width,H=RPH.canvas.height,minWH=Math.min(W,H)},RPH.init(),window.addEventListener("resize",RPH.resizeCanvas,!1),RPH.mouse={x:0,y:0,xDrag:0,yDrag:0,isDragging:!1,get:function(a){var b=RPH.canvas.getBoundingClientRect();this.x=a.clientX-b.left,this.y=a.clientY-b.top},down:function(a){this.get(a),this.xDrag=this.x,this.yDrag=this.y,this.isDragging=!0},up:function(a){this.get(a),this.isDragging=!1},move:function(a){this.get(a)},draw:function(){RPH.pen.circle(this.x,this.y,5)}},RPH.pen={clear:function(){RPH.ctx.clearRect(0,0,W,H)},rect:function(a,b,c,d){RPH.ctx.beginPath(),RPH.ctx.rect(a,b,c,d),RPH.ctx.closePath(),RPH.ctx.fill()},circle:function(a,b,c){RPH.ctx.beginPath(),RPH.ctx.arc(a,b,c,0,2*Math.PI,!0),RPH.ctx.fill()}},RPH.phone={alpha:0,alphaPrev:0,oBeta:4*Math.PI/9,dBeta:Math.PI/7,rBeta:Math.PI/24,r0:.35,r2:.23,r1:.29,r3:.04,fontString:"",activeDigit:-1,setDrag:function(){var a=this.centroid.x,b=this.centroid.y;this.alpha=RPH.math.getAngle(W*a,H*b,RPH.mouse.x,RPH.mouse.y)-RPH.math.getAngle(W*a,H*b,RPH.mouse.xDrag,RPH.mouse.yDrag),this.alpha=this.alpha<0?0:this.alpha,this.alpha>(10-this.activeDigit)*this.dBeta+this.rBeta&&(RPH.mouse.isDragging=!1,RPH.dialer.number.length<12&&(RPH.dialer.number+=this.activeDigit),(3===RPH.dialer.number.length||7===RPH.dialer.number.length)&&(RPH.dialer.number+="-"),this.activeDigit=-1)},setActiveDigit:function(){var a;for(this.activeDigit=-1,i=0;10>i;i+=1)a=this.oBeta+this.dBeta*i+this.alpha,xt=W*this.centroid.x+minWH*this.r1*Math.cos(a),yt=H*this.centroid.y+minWH*this.r1*Math.sin(a),RPH.math.getDistance(RPH.mouse.x,RPH.mouse.y,xt,yt)<minWH*this.r3&&(this.activeDigit=i)},drawRing:function(){var a=this.centroid.x,b=this.centroid.y;RPH.ctx.fillStyle="#444444",RPH.pen.circle(W*a,H*b,minWH*this.r0),RPH.ctx.fillStyle="rgb(240,245,240)",RPH.pen.circle(W*a,H*b,minWH*this.r2)},drawLine:function(){var a=this.oBeta+10*this.dBeta+this.rBeta,b=this.centroid.x,c=this.centroid.y;RPH.ctx.strokeStyle="rgb(240,245,240)",RPH.ctx.beginPath(),RPH.ctx.moveTo(W*b+this.r0*minWH*Math.cos(a),H*c+this.r0*minWH*Math.sin(a)),RPH.ctx.lineTo(W*b+this.r1*minWH*Math.cos(a),H*c+this.r1*minWH*Math.sin(a)),RPH.ctx.lineWidth=minWH/150,RPH.ctx.stroke()},drawNumber:function(){RPH.ctx.font=minWH/25+"px "+this.fontString,RPH.ctx.fillStyle="#444444",RPH.ctx.fillText(RPH.dialer.number,W*this.text.x,H*this.text.y)},drawDigits:function(){var a,b;for(RPH.ctx.font=minWH/18+"px Courier",a=0;10>a;a+=1)RPH.ctx.fillStyle=this.activeDigit===a?"rgb(180,205,200)":"rgb(240,245,240)",b=RPH.phone.oBeta+RPH.phone.dBeta*a+RPH.phone.alpha,RPH.pen.circle(W*this.centroid.x+minWH*this.r1*Math.cos(b),H*this.centroid.y+minWH*this.r1*Math.sin(b),minWH*this.r3),RPH.ctx.fillStyle="#444444",b=RPH.phone.oBeta+RPH.phone.dBeta*a,RPH.ctx.fillText(a,W*this.centroid.x+minWH*this.r1*Math.cos(b),H*this.centroid.y+minWH*this.r1*Math.sin(b))},centroid:{x:.5,y:.55},text:{x:.5,y:.1,isHovered:function(){return RPH.mouse.y/minWH<this.y+.02&&RPH.mouse.y/minWH>this.y-.02}}},RPH.math={getDistance:function(a,b,c,d){return Math.pow(Math.pow(a-c,2)+Math.pow(b-d,2),.5)},getAngle:function(a,b,c,d){var e;return Math.abs(a-c)<W/100&&d>b?1*Math.PI/2:Math.abs(a-c)<W/100&&b>d?3*Math.PI/2:(e=Math.atan((d-b)/(c-a)),c>a?0>e?e+2*Math.PI:e:e+Math.PI)}};
//# sourceMappingURL=RetroPhone-v1.0.0.min.js.map